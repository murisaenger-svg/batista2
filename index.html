<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>jogo</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:black;
}
#camera{
  position:fixed;
  width:100vw;
  height:100vh;
  overflow:hidden;
}
#world{
  position:absolute;
  width:1200px;
  height:1200px;
  background:#111;
}
.entity{
  position:absolute;
  width:40px;
  height:40px;
}
#player{background:blue}
#enemy{background:red}
#key{background:yellow}
#door{background:green}
.wall{
  position:absolute;
  background:#555;
}
#arrow{
  position:fixed;
  top:20px;
  left:50%;
  width:0;
  height:0;
  border-left:15px solid transparent;
  border-right:15px solid transparent;
  border-bottom:30px solid white;
  transform:translateX(-50%);
  z-index:10;
}
#darkness{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:9;
}
</style>
</head>

<body>

<canvas id="darkness"></canvas>
<div id="arrow"></div>

<div id="camera">
  <div id="world">
    <div id="player" class="entity"></div>
    <div id="enemy" class="entity"></div>
    <div id="key" class="entity"></div>
    <div id="door" class="entity"></div>

    <div class="wall" style="top:0;left:0;width:1200px;height:40px"></div>
    <div class="wall" style="bottom:0;left:0;width:1200px;height:40px"></div>
    <div class="wall" style="top:0;left:0;width:40px;height:1200px"></div>
    <div class="wall" style="top:0;right:0;width:40px;height:1200px"></div>
  </div>
</div>

<script>
const world=document.getElementById("world")
const player=document.getElementById("player")
const enemy=document.getElementById("enemy")
const keyItem=document.getElementById("key")
const door=document.getElementById("door")
const arrow=document.getElementById("arrow")

const canvas=document.getElementById("darkness")
const ctx=canvas.getContext("2d")

canvas.width=innerWidth
canvas.height=innerHeight
window.onresize=()=>{
  canvas.width=innerWidth
  canvas.height=innerHeight
}

const worldSize=1200
const wall=40

let px=100
let py=100
let ex=600
let ey=600
let dx=1050
let dy=1050
let kx=300
let ky=900

const keys={}
document.addEventListener("keydown",e=>keys[e.key]=true)
document.addEventListener("keyup",e=>keys[e.key]=false)

function clamp(v,min,max){
  return Math.max(min,Math.min(max,v))
}

function drawDarkness(){
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.fillStyle="rgba(0,0,0,0.95)"
  ctx.fillRect(0,0,canvas.width,canvas.height)

  ctx.globalCompositeOperation="destination-out"
  const grad=ctx.createRadialGradient(
    canvas.width/2,
    canvas.height/2,
    40,
    canvas.width/2,
    canvas.height/2,
    160
  )
  grad.addColorStop(0,"rgba(0,0,0,1)")
  grad.addColorStop(1,"rgba(0,0,0,0)")
  ctx.fillStyle=grad
  ctx.beginPath()
  ctx.arc(canvas.width/2,canvas.height/2,160,0,Math.PI*2)
  ctx.fill()
  ctx.globalCompositeOperation="source-over"
}

function loop(){
  let nx=px
  let ny=py

  if(keys["w"])ny-=6
  if(keys["s"])ny+=6
  if(keys["a"])nx-=6
  if(keys["d"])nx+=6

  px=clamp(nx,wall,worldSize-wall-40)
  py=clamp(ny,wall,worldSize-wall-40)

  if(px<ex)ex-=2.5
  if(px>ex)ex+=2.5
  if(py<ey)ey-=2.5
  if(py>ey)ey+=2.5

  const camX=clamp(px-innerWidth/2,0,worldSize-innerWidth)
  const camY=clamp(py-innerHeight/2,0,worldSize-innerHeight)

  world.style.left=-camX+"px"
  world.style.top=-camY+"px"

  player.style.left=px+"px"
  player.style.top=py+"px"
  enemy.style.left=ex+"px"
  enemy.style.top=ey+"px"
  keyItem.style.left=kx+"px"
  keyItem.style.top=ky+"px"
  door.style.left=dx+"px"
  door.style.top=dy+"px"

  const ang=Math.atan2(dy-py,dx-px)*180/Math.PI
  arrow.style.transform=`translateX(-50%) rotate(${ang+90}deg)`

  drawDarkness()
  requestAnimationFrame(loop)
}
loop()
</script>

</body>
</html>

