<!DOCTYPE html>
<html>
<head>
<style>
body {
  margin: 0;
  overflow: hidden;
  background: #000;
}

#world {
  position: relative;
  width: 2000px;
  height: 2000px;
  background: #111;
}

.entity {
  position: absolute;
  width: 40px;
  height: 40px;
}

#player { background: blue; }
#enemy { background: red; }
#key { background: yellow; }
#door { background: green; }

#arrow {
  position: fixed;
  top: 20px;
  left: 50%;
  z-index: 9999;
  width: 0;
  height: 0;
  border-left: 15px solid transparent;
  border-right: 15px solid transparent;
  border-bottom: 30px solid white;
  transform-origin: center;
}
</style>
</head>
<body>

<div id="arrow"></div>

<div id="world">
  <div id="player" class="entity"></div>
  <div id="enemy" class="entity"></div>
  <div id="key" class="entity"></div>
  <div id="door" class="entity"></div>
</div>

<script>
const player = document.getElementById("player")
const enemy = document.getElementById("enemy")
const keyItem = document.getElementById("key")
const door = document.getElementById("door")
const arrow = document.getElementById("arrow")

let px = 100
let py = 100

let ex = 500
let ey = 500

let dx = 1700
let dy = 1700

let kx
let ky

const speed = 6
const enemySpeed = 3

let hasKey = false
let alive = true

const keys = {}

function randomKeyPos() {
  do {
    kx = Math.random() * 1800
    ky = Math.random() * 1800
  } while (Math.hypot(kx - px, ky - py) < 300)
}

randomKeyPos()

document.addEventListener("keydown", e => {
  keys[e.key.toLowerCase()] = true
})

document.addEventListener("keyup", e => {
  keys[e.key.toLowerCase()] = false
})

function gameLoop() {
  if (!alive) return

  if (keys["w"]) py -= speed
  if (keys["s"]) py += speed
  if (keys["a"]) px -= speed
  if (keys["d"]) px += speed

  if (px < ex) ex -= enemySpeed
  if (px > ex) ex += enemySpeed
  if (py < ey) ey -= enemySpeed
  if (py > ey) ey += enemySpeed

  if (!hasKey && Math.abs(px - kx) < 40 && Math.abs(py - ky) < 40) {
    hasKey = true
    keyItem.style.display = "none"
  }

  if (hasKey && Math.abs(px - dx) < 40 && Math.abs(py - dy) < 40) {
    alert("voce venceu")
    alive = false
  }

  if (Math.abs(px - ex) < 40 && Math.abs(py - ey) < 40) {
    alert("voce morreu")
    alive = false
  }

  const angle = Math.atan2(dy - py, dx - px) * 180 / Math.PI
  arrow.style.transform = `translateX(-50%) rotate(${angle + 90}deg)`

  player.style.left = px + "px"
  player.style.top = py + "px"

  enemy.style.left = ex + "px"
  enemy.style.top = ey + "px"

  keyItem.style.left = kx + "px"
  keyItem.style.top = ky + "px"

  door.style.left = dx + "px"
  door.style.top = dy + "px"

  const camX = Math.round(px - window.innerWidth / 2 + 20)
  const camY = Math.round(py - window.innerHeight / 2 + 20)

  window.scrollTo(camX, camY)

  requestAnimationFrame(gameLoop)
}

gameLoop()
</script>

</body>
</html>
