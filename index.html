<!DOCTYPE html>
<html>
<head>
<style>
body {
  margin: 0;
  overflow: hidden;
  background: #000;
}

#camera {
  position: fixed;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}

#world {
  position: absolute;
  width: 1200px;
  height: 1200px;
  background: #111;
}

.wall {
  position: absolute;
  background: #555;
}

.entity {
  position: absolute;
  width: 40px;
  height: 40px;
}

#player { background: blue; }
#enemy { background: red; }
#key { background: yellow; }
#door { background: green; }

#arrow {
  position: fixed;
  top: 20px;
  left: 50%;
  z-index: 9999;
  width: 0;
  height: 0;
  border-left: 15px solid transparent;
  border-right: 15px solid transparent;
  border-bottom: 30px solid white;
  transform-origin: center;
}
</style>
</head>
<body>

<div id="arrow"></div>

<div id="camera">
  <div id="world">

    <div id="player" class="entity"></div>
    <div id="enemy" class="entity"></div>
    <div id="key" class="entity"></div>
    <div id="door" class="entity"></div>

    <div class="wall" style="top:0;left:0;width:1200px;height:40px"></div>
    <div class="wall" style="bottom:0;left:0;width:1200px;height:40px"></div>
    <div class="wall" style="top:0;left:0;width:40px;height:1200px"></div>
    <div class="wall" style="top:0;right:0;width:40px;height:1200px"></div>

  </div>
</div>

<script>
const world = document.getElementById("world")
const player = document.getElementById("player")
const enemy = document.getElementById("enemy")
const keyItem = document.getElementById("key")
const door = document.getElementById("door")
const arrow = document.getElementById("arrow")

const worldSize = 1200
const wallSize = 40

let px = 100
let py = 100

let ex = 600
let ey = 600

let dx = 1050
let dy = 1050

let kx
let ky

const speed = 6
const enemySpeed = 2.5

let hasKey = false
let alive = true

const keys = {}

function randomKeyPos() {
  do {
    kx = Math.random() * (worldSize - 200) + 100
    ky = Math.random() * (worldSize - 200) + 100
  } while (Math.hypot(kx - px, ky - py) < 300)
}

randomKeyPos()

document.addEventListener("keydown", e => {
  keys[e.key.toLowerCase()] = true
})

document.addEventListener("keyup", e => {
  keys[e.key.toLowerCase()] = false
})

function clamp(value,min,max) {
  return Math.max(min,Math.min(max,value))
}

function gameLoop() {
  if (!alive) return

  let nx = px
  let ny = py

  if (keys["w"]) ny -= speed
  if (keys["s"]) ny += speed
  if (keys["a"]) nx -= speed
  if (keys["d"]) nx += speed

  px = clamp(nx,wallSize,worldSize - wallSize - 40)
  py = clamp(ny,wallSize,worldSize - wallSize - 40)

  if (px < ex) ex -= enemySpeed
  if (px > ex) ex += enemySpeed
  if (py < ey) ey -= enemySpeed
  if (py > ey) ey += enemySpeed

  ex = clamp(ex,wallSize,worldSize - wallSize - 40)
  ey = clamp(ey,wallSize,worldSize - wallSize - 40)

  if (!hasKey && Math.abs(px - kx) < 40 && Math.abs(py - ky) < 40) {
    hasKey = true
    keyItem.style.display = "none"
  }

  if (hasKey && Math.abs(px - dx) < 40 && Math.abs(py - dy) < 40) {
    alert("voce venceu")
    alive = false
  }

  if (Math.abs(px - ex) < 40 && Math.abs(py - ey) < 40) {
    alert("voce morreu")
    alive = false
  }

  const angle = Math.atan2(dy - py,dx - px) * 180 / Math.PI
  arrow.style.transform = `translateX(-50%) rotate(${angle + 90}deg)`

  player.style.left = px + "px"
  player.style.top = py + "px"

  enemy.style.left = ex + "px"
  enemy.style.top = ey + "px"

  keyItem.style.left = kx + "px"
  keyItem.style.top = ky + "px"

  door.style.left = dx + "px"
  door.style.top = dy + "px"

  const camX = clamp(px - window.innerWidth / 2,0,worldSize - window.innerWidth)
  const camY = clamp(py - window.innerHeight / 2,0,worldSize - window.innerHeight)

  world.style.left = -camX + "px"
  world.style.top = -camY + "px"

  requestAnimationFrame(gameLoop)
}

gameLoop()
</script>

</body>
</html>
